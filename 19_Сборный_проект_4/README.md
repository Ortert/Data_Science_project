# Oписание проекта - Поиск по изображения по текстовому запросу

Для демонстрационной версии нужно обучить модель, которая получит векторное представление изображения, векторное представление текста, а на выходе выдаст число от 0 до 1 — покажет, насколько текст и картинка подходят друг другу.

Также необходимо учитывать, юридические ограничения. В некоторых странах, действуют ограничения по обработке изображений: поисковым сервисам и сервисам, предоставляющим возможность поиска, запрещено без разрешения родителей или законных представителей предоставлять любую информацию, в том числе, но не исключительно, текстов, изображений, видео и аудио, содержащие описание, изображение или запись голоса детей. Ребёнком считается любой человек, не достигший 16-ти лет..

## Данные

В файле `train_dataset.csv` находится информация, необходимая для обучения: имя файла изображения, идентификатор описания и текст описания. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат `<имя файла изображения>#<порядковый номер описания>`.

В папке `train_images` содержатся изображения для тренировки модели.

В файле `CrowdAnnotations.tsv` — данные по соответствию изображения и описания, полученные с помощью краудсорсинга. Номера колонок и соответствующий тип данных:

1. Имя файла изображения.
2. Идентификатор описания.
3. Доля людей, подтвердивших, что описание соответствует изображению.
4. Количество человек, подтвердивших, что описание соответствует изображению.
5. Количество человек, подтвердивших, что описание не соответствует изображению.

В файле `ExpertAnnotations.tsv` содержатся данные по соответствию изображения и описания, полученные в результате опроса экспертов. Номера колонок и соответствующий тип данных:

1. Имя файла изображения.
2. Идентификатор описания.

3, 4, 5 — оценки трёх экспертов.

Эксперты ставят оценки по шкале от 1 до 4, где 1 — изображение и запрос совершенно не соответствуют друг другу, 2 — запрос содержит элементы описания изображения, но в целом запрос тексту не соответствует, 3 — запрос и текст соответствуют с точностью до некоторых деталей, 4 — запрос и текст соответствуют полностью.

В файле `test_queries.csv` находится информация, необходимая для тестирования: идентификатор запроса, текст запроса и релевантное изображение. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат `<имя файла изображения>#<порядковый номер описания>`.

В папке `test_images` содержатся изображения для тестирования модели.

## Задача

Разработать демонстрационную версию поиска изображений по запросу.

## Используемые библиотеки
*os*, *re*, *ntpath*, *glob*, *pandas*, *numpy*, *matplotlib*, *seaborn* *Pytorch*, *textwrap*, *PIL*,  *sklearn*, *torchvision*, *transformers*, *SentenceTransformer*

## Вывод

В рамках выполнения проекта по обучению модели, которая получит векторное представление изображения, векторное представление текста, а на выходе выдаст число от 0 до 1 — покажет, насколько текст и картинка подходят друг другу, было выполнено:
- загружены и проверены на корректность вывода таблтчные данные и изучаемые изображения
- выведена общая информация о датасетах, проверен тип данных
- датасеты изучены на наличие пропусков и дубликатов в данных. Пропуски и дубликаты отсутствуют.
- сформирован целевой признак 'target' на основании следующей логики: итоговая оценка будет формироваться как доля подтвердивших соответствие в результате краудфандинговой оценки с коэффициентом 0.4 плюс средняя нормализованная оценка экспертов с коэффициентом 0.6. По итогу величина финальной оценки будет находиться в интервале [0, 1].
- в целях ненарушения законов стран, в которых  действуют ограничения по обработке изображений в части поиска изображений детей, отображаемых без согласия родителей или законных представителей, из тренировочного датасета, были удалены изображения соответсвующие запросам содержащим стоп - слова  'boy', 'boys', 'girl', 'girls', 'kid', 'kids', 'child', 'children', 'baby', 'babies', 'teen', 'teenager'.
- изображения тренировочного датасета были преобразованы в векторные эмбеддинги с помощью предобученной модели архитектуры ResNet18, с исключенным последним полносвязным слоем. полученные эмбеддинги были преобразованы в датасет pandas.
-  текстовые описания тренировочного датасета были преобразованы в векторные эмбеддинги с помощью предобученной модели архитектуры BERT. Полученные эмбеддинги были преобразованы в датасет pandas.
-  выполнено объединение датафрейма тренировочного датасета, с полученными ранее датасетами эмбеддингов изображений и текстов.
- разделили данные на тренировочную и тестовую выборки с помощью класса GroupShuffleSplit
- обучили и получили предсказания с помощью следуюших моделей:  
а) базовая модель линейной регресии LinearRegression()   
б) модель с кросс валидацией RidgeCV() со встроенной перекрестной проверкой альфа-параметра  
в) полносвязная нейронная сеть  
В качестве метрики качества используем RMSE
- по итогу работы модели получили следующие результаты на тестовой выборке:  
а) LinearRegression: RMSE = 1.558142   
б) RidgeCV: RMSE = 0.394241  
в) NeuralNet: RMSE = 0.303910

Для дальнейшей работы будем использовать полносвязную нейронную сеть
Как показал визуальный контроль работы моделей на тестовой выборке, наша полносвязная нейронная сеть частично выполняет свою задачу, например выводит собак, если в запросе есть слово 'dog', выводит некие "игровые" фото, если есть слово 'ball', но в целом результат работы нельзя назвать удовлетворительным. Возможно из за небольшой выборки для обучения или плохо подобранной архитектуры нейронной сети (недостаточно низкий RMSE). В связи с этим для поиска изображений была использована предобученная модель CLIP, которая в показала хороший результат, который может быть презентован Заказчику.
