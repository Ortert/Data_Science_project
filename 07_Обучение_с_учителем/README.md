# Персонализация предложений постоянным клиентам интернет-магазина "В один клик"

## Описание проекта

Интернет-магазин «В один клик» продаёт разные товары: для детей, для дома, мелкую бытовую технику, косметику и даже продукты. Отчёт магазина за прошлый период показал, что активность покупателей начала снижаться. Привлекать новых клиентов уже не так эффективно: о магазине и так знает большая часть целевой аудитории. Возможный выход — удерживать активность постоянных клиентов. Сделать это можно с помощью персонализированных предложений.

Необходимо разработать решение, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность.

## Данные

    
*id* — номер покупателя в корпоративной базе данных.

*Покупательская активность* — рассчитанный класс покупательской активности (целевой признак): «снизилась» или «прежний уровень».

*Тип сервиса* — уровень сервиса, например «премиум» и «стандарт».

*Разрешить сообщать* — информация о том, можно ли присылать покупателю дополнительные предложения о товаре. Согласие на это даёт покупатель.

*Маркет_актив_6_мес* — среднемесячное значение маркетинговых коммуникаций компании, которое приходилось на покупателя за последние 6 месяцев. Это значение показывает, какое число рассылок, звонков, показов рекламы и прочего приходилось на клиента.

*Маркет_актив_тек_мес* — количество маркетинговых коммуникаций в текущем месяце.

*Длительность* — значение, которое показывает, сколько дней прошло с момента регистрации покупателя на сайте.

*Акционные_покупки* — среднемесячная доля покупок по акции от общего числа покупок за последние 6 месяцев.

*Популярная_категория* — самая популярная категория товаров у покупателя за последние 6 месяцев.

*Средний_просмотр_категорий_за_визит* —  показывает, сколько в среднем категорий покупатель просмотрел за визит в течение последнего месяца.

*Неоплаченные_продукты_штук_квартал* — общее число неоплаченных товаров в корзине за последние 3 месяца.

*Ошибка_сервиса* — число сбоев, которые коснулись покупателя во время посещения сайта.

*Страниц_за_визит* - среднее количество страниц, которые просмотрел покупатель за один визит на сайт за последние 3 месяца.


***Данные о выручке, которую получает магазин с покупателя, то есть сколько покупатель всего потратил за период взаимодействия с сайтом — market_money.csv***

*id* — номер покупателя в корпоративной базе данных.

*Период* — название периода, во время которого зафиксирована выручка. Например, 'текущий_месяц' или 'предыдущий_месяц'.

*Выручка* - сумма выручки за период.


***Данные о времени (в минутах), которое покупатель провёл на сайте в течение периода —  market_time.csv***

*id* — номер покупателя в корпоративной базе данных.

*Период* — название периода, во время которого зафиксировано общее время.

*минут* — значение времени, проведённого на сайте, в минутах.


***Данные о среднемесячной прибыли покупателя за последние 3 месяца: какую прибыль получает магазин от продаж каждому покупателю —  money.csv***

*id* — номер покупателя в корпоративной базе данных.

*Прибыль* — значение прибыли.

## Используемые библиотеки

*pandas*, *numpy*, *scipy*, *matplotlib*, *seaborn*, *sklearn*, *SHAP*

## Выводы 

Отчёт магазина за прошлый период показал, что активность покупателей начала снижаться. выход из данной ситуации — удерживать активность постоянных клиентов. Сделать это планируется с помощью персонализированных предложений.

Необходимо разработать решение, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность, но для начала необходимо определить клиентов, покупательская способность которых будет снижена в ближайщее время.

Предоставленные к исследованию датасеты проверены на наличие пропусков, корректность типа данных, явных и неявных дубликатов (по номеру id). Пропуски и дубликаты в исследуемых датафреймах не выявлены, типы данных значений корректны. Дополнительная обработка данных не требуется.

Из всех датасетов удалены id пользователей, имеющих выручку равную нулю, хотя бы в одном, из трех последних месяцев. По результатам проведенного исследовательского анализа изучаемых датасетов, можно прийти к выводу, что вцелом представленные данные не содержат аномальных значений. Столбец 'выручка' датасета money имеет выброс значением 106862, однако данное значение реально в рамках имеющегося набора данных и поэтому датафрейм money оставлен без изменений. Распределение значений вцелом имеет вид нормального с более или менее выраженными смещениями относительно центра значений.

Выполнено объединение датасетов market, money и time в один датафрейм. Значения выручки и времени из датасетов money и time, пропиcаны в отдельном столбце для каждого периода.

Определены коэффициенты корреляции Спирмена, построены матрица и тепловыая карта со значениями коэффициентов корреляции. Сильнокоррелирующие положительно параметры не выявлены, имеются параметры имеющие сильную отрицательную корреляцию - 'минут_предыдущий_месяц' и 'минут_текущий_месяц'. Для поиска лучшей модели и метрики для поиска клиентов покупательская активность которых будет снижаться в ближайшее время, построен и просчитан пайплайн, со следующими исходными параметрами:

в качестве кодировщиков использовались OheHotEncoder и OrdinalEncoder.
в качестве скейлеров использовались StandaradScaler, MinMaxScaler, RobustScaler.
в качестве моделей МО применялись KNeighborsClassifier() (перебирали гиперпараметр 'n_neighbors', DecisionTreeClassifier() (перебирали гиперпараметры 'max_depth', 'min_samples_split', 'min_samples_leaf' , LogisticRegression(перебирали гиперпараметр 'С') и SVC(перебирали гиперпараметр 'degree').
в качестве метрики, с помощью которой будет оценивалось качество модели, использовали ROC-AUC.
По итогу лучшие показатели показала модель со следующими параметрами:

кодировщик OheHotEncoder;
скейлер StandaradScaler;
модель DecisionTreeClassifier() с гиперпараметрами 'max_depth' = 18, 'min_samples_split' = 8.
Лучшая метрика ROC-AUC полученная на кросс-валидационной выборке равно 0.9874060771432089

Лучшая метрика ROC-AUC полученная на тестовой выборке равно 0.9961815962561071

Исходя из полученных значений разброса и смещенияможно сказать о том, что модель получила достаточно сведений для принятия решений, при этом не переобучившись.

По результатам анализа графиков SHAP, можно прийти к следующим выводам: Возьмем за границу, разделяющую важные признаки от неважных - среднее значение Шепли, равные 0.02. Тогда получим, что:

менее всего на прогноз целевого признака влияют следующие входные параметры: 'выручка', 'тип_сервиса', 'разрешить_сообщать', 'маркет_актив_тек_месяц';
более всего на прогноз целевого признака влияют следующие входные параметры: 'страниц за визит', 'акционные_покупки', 'маркет_актив_6_мес', 'просмотр категорий за визит', 'минут', 'неоплаченные_продукты_штук_квартал', 'длительность', 'ошибка_сервиса'. На основании описанного выше, для увеличения покупательской активности вцелом можно рекомендовать отделу маркетинга делать рассылки, которые приводят к переходу покупателей на страницы магазина, т.к. 'страниц за визит' это самый влиятельный входной признак (также в числе влиятельный признаков 'просмотр категорий за визит', 'минут', 'длительность' - величина данных параметров зависит от количетсва переходов и степенью заинтересованности информацией на страницах сайта/приложения. Также можно рекомендовать предложение клиентам акционных покупок и увеличение маркетинговой активности целом.
С целью повышения покупательской активности клиентов, получивших прогнох о снижении покупательской способности в ближайшее время, был сформирован датафрейм с id покупателей, получивших такой прогноз, к этому датафрейму были добавлены сведения о прибыли от данных клиентов, за последнии 3 месяца и категории любимых товаров, которые покупают данные пользователи. После чего было определено топ-3 категорий товаров среди отфильтрованных пользователей. В итоговый датафрейм отобрали пользователей популярной категорией товаров из топ-3 и отфильтровали его по убыванию прибыли.

Полученный список из 353 человек, может быть передан маркетолагам с целью проведения акционных рассылок по данному списку (т.к. акционные покупки являются важным признаком, желательно, чтобы ссылки содержащиеся в данном письме, побуждали покупателя к переходу на сайт (таким образом пытаясь увеличить параметры 'страниц за визит' и 'просмотр категорий за визит') По результатам распределения прибыли отфильтрованного и общего датасета, утановлено, что отфильтрованный датасет, вцелом, не сильно отличается от общего набора данных по параметру 'прибыль', что говорит о том, что затраты на маркетинговые мероприятия по удержанию данных клиентов обоснованы, так как данные клиенты приносят компании среднестатистическую прибыль.
