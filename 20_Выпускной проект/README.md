# Oписание проекта - Прогноз оттока клиентов Телеком-провайдера

Оператор связи «ТелеДом» хочет бороться с оттоком клиентов. Для этого его сотрудники начнут предлагать промокоды и специальные условия всем, кто планирует отказаться от услуг связи. Чтобы заранее находить таких пользователей, «ТелеДому» нужна модель, которая будет предсказывать, разорвёт ли абонент договор. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и услугах.
Задача исследования — обучить на предоставленных Заказчиком данных модель для прогноза оттока клиентов.

**Описание услуг:**  

Оператор предоставляет два основных типа услуг:
- Стационарную телефонную связь. Телефон можно подключить к нескольким линиям одновременно.
- Интернет. Подключение бывает двух типов: через телефонную линию DSL (англ. digital subscriber line — «цифровая абонентская линия») или оптоволоконный кабель (англ. fiber optic).  

Также абонентам доступен ряд услуг:
- Интернет-безопасность: антивирус (Device Protection) и блокировка опасных сайтов (Online Security);
- Выделенная линия технической поддержки (Tech Support);
- Облачное хранилище файлов для резервного копирования данных (Online Backup);
- Стриминговое телевидение (Streaming TV) и каталог фильмов (Streaming Movies).  
За услуги клиенты могут платить ежемесячно или раз в 1–2 года. Доступны различные способы расчёта и возможность получить электронный чек.

## Данные

***Данные хранятся в Sqlite  — СУБД, в которой база данных представлена одним файлом. Она состоит из нескольких таблиц:***
    
- contract — информация о договорах;
- personal — персональные данные клиентов;
- internet — информация об интернет-услугах;
- phone — информация об услугах телефонии.


***Таблица contract***

- customerID — ID абонента;
- BeginDate — дата начала действия договора;
- EndDate — дата окончания действия договора;
- Type — тип оплаты: раз в год-два или ежемесячно;
- PaperlessBilling — электронный расчётный лист;
- PaymentMethod — тип платежа;
- MonthlyCharges — расходы за месяц;
- TotalCharges — общие расходы абонента.

***Таблица personal***

- customerID — ID пользователя;
- gender — пол;
- SeniorCitizen — является ли абонент пенсионером;
- Partner — есть ли у абонента супруг или супруга;
- Dependents — есть ли у абонента дети.

***Таблица internet***

- customerID — ID пользователя;
- InternetService — тип подключения;
- OnlineSecurity — блокировка опасных сайтов;
- OnlineBackup — облачное хранилище файлов для резервного копирования данных;
- DeviceProtection — антивирус;
- TechSupport — выделенная линия технической поддержки;
- StreamingTV — стриминговое телевидение;
- StreamingMovies — каталог фильмов.

***Таблица phone***

- customerID — ID пользователя;
- MultipleLines — подключение телефона к нескольким линиям одновременно.

## Задача

Построить модель, которая будет предсказывать разорвет ли абонент Договор с Провайдером. Заказчик планирует использовать модель для рассылки промокодов и специальных условий клиентам, склонным к разрыву контракта.

## Используемые библиотеки
*os*, *pandas*, *numpy*, *seaborn*, *matplotlib*, *Pytorch*, *sklearn*, *sqlalchemy*, *phik*, *lightgbm*, *catboost*, *SHAP*

## Вывод

 рамках данного исследования:
- выполнено подключение к базе данных с исходными данными Заказчика
- выполнен тестовый запрос на подключение и вывод необходимой информации
- загружены необходимые для исследования датасеты;
- датасеты проверены на корректность вывода;
- датасет проверен на наличие пропусков в данных (выявленные пропуски удалены);
- данные проверены на наличие явных дубликатов (не выявлены);
- значения имеющие некорректный тип данных приведены к типу, наиболее подходящему, для проведения исследования;
- проведен исследовательский анализ в части распределений входных признаков
- исходные датафреймы объединены в итоговый датасет с учётом особенностей услуг телекоммуникации;
- объединенный датасет исследован на пропуски и явные дубликатыю Выявленные пропуски обработаны, дубликаты не выявлены
- сформирован целевой признак;
- сформированы дополнительные входные признаки
- проведен исследовательский анализ, в том числе в разрезе распределения признаков по таргету
- проведен корреляционный анализ, по итогу скорректирован состав обучающего датасета

Для поиска лучшей модели и метрики для поиска клиентов склонных к расторжению Договора с Заказчиком, обучены и провалидированы следующие модели с использованием пайплайна:
- в качестве кодировщиков использовалcя OheHotEncoder 
- в качестве скейлеров использовались StandaradScaler, MinMaxScaler, RobustScaler.
- в качестве моделей МО применялись
а) RandomForestClassifier() с перебором гиперпараметров 'class_weight', 'n_estimators' и 'max_features'.
б) LGBMClassifier() с перебором гиперпараметров 'class_weight', 'n_estimators' и 'learning_rate'.
в) CatBoostClassifier() с перебором гиперпараметров 'depth', 'loss_function', 'learning_rate'.
г) NeuralNet() 
- в качестве метрики, с помощью которой будет оценивалось качество модели, использовали ROC-AUC
- метрика рассчитавалась на кросс-валидации с количеством фолдов - 5.

По итогу лучшие показатели показала модель CatBoostClassifier() с гиперпараметрами 'max_depth' = 5, 'loss_function' = 'LogLoss' и 'learning_rate' = 0.05.

Лучшая метрика ROC-AUC полученная на кросс-валидационной выборке равно 0.934041

- проведено тестирование модели, показавшей наилучший результата на кросс-валидации, а именно CatBoostClassifier()
- выведены основные метрики и матрица ошибок модели на тестовой выборке:    
Accuracy = 0.939  
ROC-AUC = 0.948  
F1-score = 0.756  
recall = 0.659  
precision = 0.888  

- определены Топ-5 наиболее важных признаков в результате работы модели оказались:
1. Длительность контракта 'ContractDuration'
2. Тип контракта 'Two_years'
3. Подключение телефона к нескольким линиям одновременно 'MultipleLines'
4. Наличие супруга у абонента 'Partner'
5. Тип контракта 'One_year'

На основании описанного выше, для снижения количества клиентов расторгающих контракт с Заказчиком, можно рекомендовать изучить в какие конкретно даты были расторгнуты контракты с длительностями, показавшими большое количество расторжений, выяснить причины которые могли повлиять на решение клиента и устранить факторы, которые могли привести к такому решению клиента. Также можно рекомендовать Заказчику заключать Договора с оплатой помесячно, улучшить качество многоканальной телефонии, а также разработать акции для клиентов, состоящих в браке.
